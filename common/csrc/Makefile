################################################################################
#                                   LICENSE                                    #
################################################################################
#   This file is part of threejs_figures.                                      #
#                                                                              #
#   threejs_figures is free software: you can redistribute it and/or modify    #
#   it under the terms of the GNU General Public License as published by       #
#   the Free Software Foundation, either version 3 of the License, or          #
#   (at your option) any later version.                                        #
#                                                                              #
#   threejs_figures is distributed in the hope that it will be useful,         #
#   but WITHOUT ANY WARRANTY; without even the implied warranty of             #
#   MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the              #
#   GNU General Public License for more details.                               #
#                                                                              #
#   You should have received a copy of the GNU General Public License          #
#   along with threejs_figures.  If not, see <https://www.gnu.org/licenses/>.  #
################################################################################
#   Author:     Ryan Maguire                                                   #
#   Date:       October 30, 2025                                               #
################################################################################

# C / C++ settings.
CC = emcc
CXX = em++
AR = emar
CFLAGS = -I./ -Wall -Wextra -Wpedantic -O3 -flto

# Location of the C and C++ code, and the build directory for them.
C_SRC_DIR = threetools
CXX_SRC_DIR = jsbindings
BUILD_DIR = build

# Find all C source files.
C_SRCS = $(wildcard $(C_SRC_DIR)/*.c)
C_OBJS = $(patsubst $(C_SRC_DIR)/%.c,$(BUILD_DIR)/%.o,$(C_SRCS))

# Find all C++ source files.
CXX_SRCS = $(wildcard $(CXX_SRC_DIR)/*.cpp)
CXX_OBJS = $(patsubst $(CXX_SRC_DIR)/%.cpp,$(BUILD_DIR)/%.o,$(CXX_SRCS))

# JavaScript output files generated by emscripten.
LIBRARY_FILE = libthreetools.a
LIBRARY_WASM = libthreetools.wasm

.PHONY: all clean

all: $(LIBRARY_FILE)

$(BUILD_DIR)/%.o: $(C_SRC_DIR)/%.c
	@mkdir -p $(BUILD_DIR)
	$(CC) $(CFLAGS) $< -c -o $@

$(BUILD_DIR)/%.o: $(CXX_SRC_DIR)/%.cpp
	@mkdir -p $(BUILD_DIR)
	$(CXX) $(CFLAGS) $< -c -o $@

$(LIBRARY_FILE): $(C_OBJS) $(CXX_OBJS)
	$(AR) rcs $@ $(C_OBJS)

clean:
	rm -rf $(BUILD_DIR)
	rm -f $(LIBRARY_FILE) $(LIBRARY_WASM)
